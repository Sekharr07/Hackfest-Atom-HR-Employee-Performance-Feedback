<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recent Feedback</title>
    <style>
         body { font-family: sans-serif; margin: 20px; }
         h1 { color: #333; }
         .feedback-entry { border: 1px solid #eee; padding: 10px; margin-bottom: 15px; border-radius: 5px; background-color: #fff; }
         .feedback-entry p { margin: 5px 0; }
         .feedback-text { background-color: #f8f8f8; padding: 8px; border-radius: 3px; white-space: pre-wrap; font-style: italic;}
         strong { color: #0056b3; }
        .flash { padding: 10px; margin-bottom: 15px; border-radius: 4px; }
        .flash.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        a { color: #007bff; text-decoration: none; margin-top: 15px; display: inline-block;}
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>Recent Feedback Submissions</h1>

     <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if feedback_list %}
        {% for feedback in feedback_list %}
        <div class="feedback-entry">
            <p><strong>Employee:</strong> {{ feedback.employee_name }}</p>
            <p><strong>Feedback:</strong></p>
            <div class="feedback-text">{{ feedback.feedback_text }}</div>
            <p><strong>Submitter:</strong> {{ feedback.get('submitter_name', 'Anonymous') }}</p>
            <p><strong>Submitted At:</strong> {{ feedback.submitted_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}</p>
            {% if feedback.analysis %}
                <p><strong>Sentiment:</strong> {{ feedback.analysis.get('sentiment', 'N/A') }}</p>
                <p><strong>Rating:</strong> {{ feedback.analysis.get('rating', 'N/A') }}</p>
                {% if feedback.analysis.get('error') %}
                    <p style="color: red;"><strong>Analysis Error:</strong> {{ feedback.analysis.error }}</p>
                {% endif %}
            {% else %}
                <p>No analysis data available.</p>
            {% endif %}
             <p><small>ID: {{ feedback._id }}</small></p>
        </div>
        {% endfor %}
    {% else %}
        <p>No feedback entries found.</p>
    {% endif %}

     <a href="{{ url_for('index') }}">Back to Submit Feedback</a>

</body>
</html>